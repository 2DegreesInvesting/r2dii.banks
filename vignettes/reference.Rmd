---
title: "Reference"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  collapse = TRUE,
  comment = "#>"
)

library(dplyr)
library(pkgdoc)

pkg <- paste0("r2dii.", c("data", "match", "analysis"))
lapply(pkg, library, character.only = TRUE)

stopifnot(
  all_pkg_must_be_attached = all(
    paste0("package:", pkg) %in% search()
  )
)
```

```{r, warning=FALSE}
url_r2dii <- "https://2degreesinvesting.github.io/"
search_default <- "dataset"

r2dii_reference_concept <- function(x) {
  custom_table(
    reference_concept(
      x, url = url_r2dii, packages = r2dii.utils::r2dii_packages()
    )
  )
}
r2dii_reference_package <- function(x, packages = pkg) {
  custom_table(
    reference_package(
      x, url = url_r2dii, packages = packages
    )
  )
}
custom_table <- function(x) {
  x %>% 
    select(-package, -concept) %>% 
    unique() %>%
    knitr::kable(
      x, 
      format = "html",
      col.names = NULL,
      escape = FALSE
    ) %>%
    kableExtra::column_spec(1, bold = TRUE) %>% 
    kableExtra::column_spec(2, width = "20em")
}
```

### Global search

```{r global-search, warning=FALSE}
pkg %>% 
  purrr::map_dfr(reference_package, url = url_r2dii) %>% 
  select(-package, -concept) %>% 
  unique() %>% 
  purrr::set_names(c("", "object", "description")) %>% 
  DT::datatable(
    escape = FALSE,
    rownames = NULL,
    options = list(
      # f: filter, t: table, i: information
      dom = "fti",
      search = list(search = search_default)
    )
  )
```

```{r}
describe_package <- function(package) {
  link <- glue::glue("<a href={url_r2dii}/{package}>{package}</a>")
  title <- utils::packageDescription(package, fields = "Title")
  paste0(link, ": ", title)
}
```

### `r describe_package(pkg[[1]])`

```{r}
r2dii_reference_package(pkg[[1]])
```

### `r describe_package(pkg[[2]])`

```{r}
r2dii_reference_package(pkg[[2]])
```

### `r describe_package(pkg[[3]])`

```{r}
r2dii_reference_package(pkg[[3]])
```

